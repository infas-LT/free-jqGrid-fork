!function(o){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],o):"object"==typeof module&&module.exports?module.exports=function(r,e){return r=r||window,void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(r)),require("./grid.base"),o(e),e}:o(jQuery)}(function(k){"use strict";var A=k.jgrid,T=k.fn.jqGrid;A.extend({groupingSetup:function(){return this.each(function(){function r(){return""}var e,o,i,t,n,a=this,l=a.p,u=l.colModel,s=l.groupingView;if(null===s||"object"!=typeof s&&!k.jgrid.isFunction(s))l.grouping=!1;else if(s.groupField.length){for(void 0===s.visibiltyOnNextGrouping&&(s.visibiltyOnNextGrouping=[]),s.lastvalues=[],s._locgr||(s.groups=[]),s.counters=[],e=0;e<s.groupField.length;e++)s.groupOrder[e]||(s.groupOrder[e]="asc"),s.groupText[e]||(s.groupText[e]="{0}"),"boolean"!=typeof s.groupColumnShow[e]&&(s.groupColumnShow[e]=!0),"boolean"!=typeof s.groupSummary[e]&&(s.groupSummary[e]=!1),s.groupSummaryPos[e]||(s.groupSummaryPos[e]="footer"),t=u[l.iColByName[s.groupField[e]]],!0===s.groupColumnShow[e]?(s.visibiltyOnNextGrouping[e]=!0,null!=t&&!0===t.hidden&&T.showCol.call(k(a),s.groupField[e])):(s.visibiltyOnNextGrouping[e]=k("#"+A.jqID(l.id+"_"+s.groupField[e])).is(":visible"),null!=t&&!0!==t.hidden&&T.hideCol.call(k(a),s.groupField[e]));for(s.summary=[],s.hideFirstGroupCol&&(s.formatDisplayField[0]=function(r){return r}),o=0,i=u.length;o<i;o++)t=u[o],s.hideFirstGroupCol&&!t.hidden&&s.groupField[0]===t.name&&(t.formatter=r),t.summaryType&&(n={nm:t.name,st:t.summaryType,v:"",sr:t.summaryRound,srt:t.summaryRoundType||"round"},t.summaryDivider&&(n.sd=t.summaryDivider,n.vd=""),s.summary.push(n))}else l.grouping=!1})},groupingPrepare:function(x,w){return this.each(function(){for(var r,e,i,t,o,n,a,l=this,u=l.p,s=u.groupingView,d=s.groups,p=s.counters,g=s.lastvalues,m=s.isInTheSameGroup,f=s.groupField.length,c=!1,h=T.groupingCalculations.handler,y=function(r,e){return null==r&&s.useDefaultValuesOnGrouping&&null!=(e=void 0!==u.iColByName[e]?u.colModel[u.iColByName[e]]:u.additionalProperties[u.iPropByName[e]])&&null!=e.formatter&&(null!=e.formatoptions&&void 0!==e.formatoptions.defaultValue?r=e.formatoptions.defaultValue:"string"==typeof e.formatter&&void 0!==(e=k(l).jqGrid("getGridRes","formatter."+e.formatter+".defaultValue"))&&(r=e)),r},v=0;v<f;v++)if(o=s.groupField[v],n=y(x[o],o),null==(a=null==(a=s.displayField[v])?null:y(x[a],a))&&(a=n),void 0!==n){for(e=[],r=0;r<=v;r++)e.push(x[s.groupField[r]]);for(i={idx:v,dataIndex:o,value:n,displayValue:a,startRow:w,cnt:1,keys:e,summary:[]},t={cnt:1,pos:d.length,summary:k.extend(!0,[],s.summary)},0===w?(d.push(i),g[v]=n,p[v]=t):"object"==typeof n||(Array.isArray(m)&&k.jgrid.isFunction(m[v])?m[v].call(l,g[v],n,v,s):g[v]===n)?c?(d.push(i),g[v]=n,p[v]=t):((t=p[v]).cnt+=1,d[t.pos].cnt=t.cnt):(d.push(i),g[v]=n,c=!0,p[v]=t),d[t.pos].summary=function(){for(var r,e,o=0;o<t.summary.length;o++)r=t.summary[o],e=Array.isArray(r.st)?r.st[i.idx]:r.st,k.jgrid.isFunction(e)?r.v=e.call(l,r.v,r.nm,x,i):(r.v=h.call(k(l),e,r.v,r.nm,r.sr,r.srt,x),"avg"===e.toLowerCase()&&r.sd&&(r.vd=h.call(k(l),e,r.vd,r.sd,r.sr,r.srt,x)));return t.summary}(),r=t.pos-1;0<=r;r--)if(d[r].idx<d[t.pos].idx){d[t.pos].parentGroupIndex=r,d[t.pos].parentGroup=d[r];break}}}),this},getGroupHeaderIndex:function(r,e){var o=this[0].p,e=e?k(e).closest("tr.jqgroup"):k("#"+A.jqID(r)),i=parseInt(e.data("jqgrouplevel"),10),o=o.id+"ghead_"+i+"_";return isNaN(i)||!e.hasClass("jqgroup")||r.length<=o.length?-1:parseInt(r.substring(o.length),10)},groupingToggle:function(c,h){return this.each(function(){function r(r){return r.find(">td>span.tree-wrap")}function e(r){for(var e=r.length,o=0;o<e;o++)m.push(r[o])}var o,i,t,n=this,a=n.p,l=a.groupingView,u=l.minusicon,s=l.plusicon,d=h?k(h).closest("tr.jqgroup"):k("#"+A.jqID(c)),p=!0,g=!1,m=[],f=parseInt(d.data("jqgrouplevel"),10);for(a.frozenColumns&&0<d.length&&(i=d[0].rowIndex,d=(d=k(n.rows[i])).add(n.grid.fbRows[i])),t=r(d),A.hasAllClasses(t,u)?(t.removeClass(u).addClass(s),g=!0):t.removeClass(s).addClass(u),d=d.next();d.length;d=d.next())if(d.hasClass("jqfoot")){if(o=parseInt(d.data("jqfootlevel"),10),g){if(o=parseInt(d.data("jqfootlevel"),10),(!l.showSummaryOnHide&&o===f||f<o)&&e(d),o<f)break}else if((o===f||l.showSummaryOnHide&&o===f+1)&&e(d),o<=f)break}else if(d.hasClass("jqgroup"))if(o=parseInt(d.data("jqgrouplevel"),10),g){if(o<=f)break;e(d)}else{if(o<=f)break;o===f+1&&(r(d).removeClass(u).addClass(s),e(d)),p=!1}else(g||p)&&e(d);k(m).css("display",g?"none":""),a.frozenColumns&&k(n).triggerHandler("jqGridResetFrozenHeights",[{header:{resizeDiv:!1,resizedRows:{iRowStart:-1,iRowEnd:-1}},resizeFooter:!1,body:{resizeDiv:!0,resizedRows:{iRowStart:i,iRowEnd:d.length?d[0].rowIndex-1:-1}}}]),n.fixScrollOffsetAndhBoxPadding(),k(n).triggerHandler("jqGridGroupingClickGroup",[c,g]),k.jgrid.isFunction(a.onClickGroup)&&a.onClickGroup.call(n,c,g)}),!1},groupingRender:function(h,y){function r(r){return T.getGuiStyles.call(C,"gridRow",r)}var v="",C=this[0],j=C.p,x=0,w=[],b=j.groupingView,F=k.makeArray(b.groupSummary),q=b.groupField.length,G=b.groups,S=j.colModel,R=S.length,N=j.page,e="jqGridShowHideCol.groupingRender",I=r("jqgroup ui-row-"+j.direction),V=r("jqfoot ui-row-"+j.direction);function O(r,e,o,i,t){var n,a,l,u,s,d,p,g,m,f,c,h,y,v=G[r],x="",w=0,F=!0;if(0!==e&&0!==G[r].idx)for(n=r;0<=n;n--)if(G[n].idx===G[r].idx-e){v=G[n];break}for(a=v.cnt,c=void 0===t?i:0;c<R;c++){for(l="&#160;",f=S[c],g=0;g<v.summary.length;g++)if(m=v.summary[g],h=Array.isArray(m.st)?m.st[o.idx]:m.st,y=Array.isArray(f.summaryTpl)?f.summaryTpl[o.idx]:f.summaryTpl||"{0}",m.nm===f.name){"string"==typeof h&&"avg"===h.toLowerCase()&&(m.sd&&m.vd?m.v=m.v/m.vd:m.v&&0<a&&(m.v=m.v/a));try{m.groupCount=v.cnt,m.groupIndex=v.dataIndex,m.groupValue=v.value,d=C.formatter("",m.v,c,m)}catch(r){d=m.v}l=A.format(y,d),f.summaryFormat&&(l=f.summaryFormat.call(C,o,l,d,f,m));break}s=u=!1,void 0===t||!F||f.hidden||(l=t,F=!1,1<i&&(u=!0,w=i-1),s=f.align,f.align="rtl"===j.direction?"right":"left",b.iconColumnName=f.name),p=!1,0<w&&!f.hidden&&"&#160;"===l?(p=!0,s&&(f.align=s),w--):(x+="<td role='gridcell' "+C.formatCol(c,1,"")+(u?"colspan='"+i+"'":"")+">"+l+"</td>",u=!1,s&&(f.align=s),p&&(f.hidden=!1,w--))}return x}return k.each(S,function(r,e){for(var o=0;o<q;o++)if(b.groupField[o]===e.name){w[o]=r;break}}),F.reverse(),k.each(G,function(r,e){var o,i,t,n,a,l,u=j.id+"ghead_"+e.idx,s=u+"_"+r,d=k.jgrid.isFunction(b.groupCollapse)?b.groupCollapse.call(C,{group:e,rowid:s}):b.groupCollapse,p=1,g=0,m=q-1===e.idx,f=null!=e.parentGroup&&e.parentGroup.collapsed,c="<span style='cursor:pointer;margin-"+("rtl"===j.direction?"right:":"left:")+12*e.idx+"px;' class='"+b.commonIconClass+" "+(d?b.plusicon:b.minusicon)+" tree-wrap'></span>";if(b._locgr&&!(e.startRow+e.cnt>(N-1)*y&&e.startRow<N*y))return!0;void 0!==(d=f?!0:d)&&(e.collapsed=d),x++;try{o=Array.isArray(b.formatDisplayField)&&k.jgrid.isFunction(b.formatDisplayField[e.idx])?(e.displayValue=b.formatDisplayField[e.idx].call(C,e.displayValue,e.value,S[w[e.idx]],e.idx,e,r),e.displayValue):C.formatter(s,e.displayValue,w[e.idx],e.value,e)}catch(r){o=e.displayValue}if(v+="<tr id='"+s+"' data-jqgrouplevel='"+e.idx+"' "+(d&&f?"style='display:none;' ":"")+"role='row' class='"+I+" "+u+"'>","string"!=typeof(s=k.jgrid.isFunction(b.groupText[e.idx])?b.groupText[e.idx].call(C,o,e.cnt,e.summary):A.template(b.groupText[e.idx],o,e.cnt,e.summary))&&"number"!=typeof s&&(s=o),"header"===b.groupSummaryPos[e.idx]?(p=1,"cb"!==S[0].name&&"cb"!==S[1].name||p++,"subgrid"!==S[0].name&&"subgrid"!==S[1].name||p++,v+=O(r,0,e,p,c+"<span class='cell-wrapper'>"+s+"</span>")):v+="<td role='gridcell' style='padding-left:"+12*e.idx+"px;' colspan='"+R+"'>"+c+s+"</td>",v+="</tr>",m){for(a=G[r+1],f=e.startRow,l=void 0!==a?a.startRow:G[r].startRow+G[r].cnt,t=f=b._locgr&&(g=(N-1)*y)>e.startRow?g:f;t<l&&h[t-g];t++)v+=h[t-g].join("");if("header"!==b.groupSummaryPos[e.idx]){if(void 0!==a){for(i=0;i<b.groupField.length&&a.dataIndex!==b.groupField[i];i++);x=b.groupField.length-i}for(n=0;n<x;n++)F[n]&&(v=(v+="<tr data-jqfootlevel='"+(e.idx-n)+(d&&(0<e.idx-n||!b.showSummaryOnHide)?"' style='display:none;'":"'")+" role='row' class='"+V+"'>")+O(r,n,G[e.idx-n],0)+"</tr>");x=i}}}),this.off(e).on(e,function(){var r,e,o,i,t=j.iColByName[b.iconColumnName];if(0<=k.inArray("header",b.groupSummaryPos)){for(i=0;i<S.length;i++)if(!S[i].hidden){o=i;break}if(void 0!==o&&t!==o){for(r=0;r<C.rows.length;r++)e=C.rows[r],k(e).hasClass("jqgroup")&&(k(e.cells[o]).html(e.cells[t].innerHTML),k(e.cells[t]).html("&nbsp;"));b.iconColumnName=S[o].name}}}),v},groupingGroupBy:function(t,n){return this.each(function(){var r,e,o=this.p,i=o.groupingView;for("string"==typeof t&&(t=[t]),o.grouping=!0,i._locgr=!1,void 0===i.visibiltyOnNextGrouping&&(i.visibiltyOnNextGrouping=[]),r=0;r<i.groupField.length;r++)e=o.colModel[o.iColByName[i.groupField[r]]],!i.groupColumnShow[r]&&i.visibiltyOnNextGrouping[r]&&null!=e&&!0===e.hidden&&T.showCol.call(k(this),i.groupField[r]);for(r=0;r<t.length;r++)i.visibiltyOnNextGrouping[r]=k(o.idSel+"_"+A.jqID(t[r])).is(":visible");o.groupingView=k.extend(o.groupingView,n||{}),i.groupField=t,k(this).trigger("reloadGrid")})},groupingRemove:function(t){return this.each(function(){var r,e=this.p,o=this.tBodies[0],i=e.groupingView;if(void 0===t&&(t=!0),!(e.grouping=!1)===t){for(r=0;r<i.groupField.length;r++)!i.groupColumnShow[r]&&i.visibiltyOnNextGrouping[r]&&T.showCol.call(k(this),i.groupField);k("tr.jqgroup, tr.jqfoot",o).remove(),k("tr.jqgrow",o).filter(":hidden").show()}else k(this).trigger("reloadGrid")})},groupingCalculations:{handler:function(r,e,o,i,t,n){var a,l={sum:function(){return parseFloat(e||0)+parseFloat(n[o]||0)},min:function(){return""===e?parseFloat(n[o]||0):Math.min(parseFloat(e),parseFloat(n[o]||0))},max:function(){return""===e?parseFloat(n[o]||0):Math.max(parseFloat(e),parseFloat(n[o]||0))},count:function(){return""===e&&(e=0),n.hasOwnProperty(o)?e+1:0},avg:function(){return l.sum()}};if(l[r])return a=l[r](),a=null!=i?"fixed"===t?a.toFixed(i):(t=Math.pow(10,i),Math.round(a*t)/t):a;throw"jqGrid Grouping No such method: "+r}}})});
//# sourceMappingURL=grid.grouping.js.map
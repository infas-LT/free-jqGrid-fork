!function(t,a){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./jqdnr","./jqmodal"],function(e){return a(e,t.document)}):"object"==typeof module&&module.exports?module.exports=function(e,t){return e=e||window,void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),require("./grid.base"),require("./jqdnr"),require("./jqmodal"),a(t,e.document),t}:a(jQuery,t.document)}("undefined"!=typeof window?window:this,function(v,j){"use strict";var y=v.jgrid,p=v.fn.jqGrid,F=p.getGuiStyles,q=p.getGridRes;y.jqModal=y.jqModal||{},v.extend(!0,y.jqModal,{toTop:!0}),v.extend(y,{showModal:function(e){e.w.show()},closeModal:function(e){e.w.hide().attr("aria-hidden","true"),e.o&&e.o.remove()},hideModal:function(e,t){var a=!(!(t=v.extend({jqm:!0,gb:"",removemodal:!1},t||{})).gb||"string"!=typeof t.gb||"#gbox_"!==t.gb.substr(0,6))&&v("#"+t.gb.substr(6))[0],i=v(e);if(t.onClose){a=a?t.onClose.call(a,e):t.onClose(e);if("boolean"==typeof a&&!a)return}if(v.fn.jqm&&!0===t.jqm)i.attr("aria-hidden","true").jqmHide();else{if(""!==t.gb)try{v(">.jqgrid-overlay",t.gb).first().hide()}catch(e){}i.hide().attr("aria-hidden","true")}t.removemodal&&i.remove()},createModal:function(e,t,a,i,o,l,n){var r=y.jqID,d=this.p,d=(a=v.extend(!0,{resizingRightBottomIcon:p.getIconRes.call(this,"form.resizableLtr")},y.jqModal||{},null!=d&&d.jqModal||{},a),j.createElement("div")),s="#"+r(e.themodal),u="rtl"===v(a.gbox).attr("dir"),c=!!e.resizeAlso&&"#"+r(e.resizeAlso),m=(n=v.extend({},n||{}),d.className=F.call(this,"dialog.window","ui-jqdialog"),d.id=e.themodal,d.dir=u?"rtl":"ltr",j.createElement("div")),f=(m.className=F.call(this,"dialog.document"),v(m).attr("role","document"),j.createElement("div")),m=(f.className=F.call(this,"dialog.subdocument"),m.appendChild(f),d.appendChild(m),j.createElement("div")),h=(m.className=F.call(this,"dialog.header","ui-jqdialog-titlebar "+(u?"ui-jqdialog-titlebar-rtl":"ui-jqdialog-titlebar-ltr")),m.id=e.modalhead,v(m).append("<span class='ui-jqdialog-title'>"+a.caption+"</span>"),F.call(this,"states.hover")),g=v("<a aria-label='Close' class='"+F.call(this,"dialog.closeButton","ui-jqdialog-titlebar-close")+"'></a>").hover(function(){g.addClass(h)},function(){g.removeClass(h)}).append("<span class='"+p.getIconRes.call(this,"form.close")+"'></span>"),u=(v(m).append(g),j.createElement("div")),t=(v(u).addClass(F.call(this,"dialog.content","ui-jqdialog-content")).attr("id",e.modalcontent),v(u).append(t),f.appendChild(u),v(f).prepend(m),!0===l?v("body").append(d):"string"==typeof l?v(l).append(d):v(d).insertBefore(i),v(d).css(n),void 0===a.jqModal&&(a.jqModal=!0),{});if(v.fn.jqm&&!0===a.jqModal?(0===a.left&&0===a.top&&a.overlay&&((a=v(o).offset()).left+=4,a.top+=4),t.top=a.top+"px",t.left=a.left):0===a.left&&0===a.top||(t.left=a.left,t.top=a.top+"px"),v("a.ui-jqdialog-titlebar-close",m).click(function(){var e=v(s).data("onClose")||a.onClose,t=v(s).data("gbox")||a.gbox;return y.hideModal(s,{gb:t,jqm:a.jqModal,onClose:e,removemodal:a.removemodal||!1}),!1}),0!==a.width&&a.width||(a.width=300),0!==a.height&&a.height||(a.height=200),a.zIndex||((f=v(i).parents("*[role=dialog]").first().css("z-index"))?(a.zIndex=parseInt(f,10)+2,a.toTop=!0):a.zIndex=950),t.left&&(t.left+="px"),v(d).css(v.extend({width:isNaN(a.width)?"auto":a.width+"px",height:isNaN(a.height)?"auto":a.height+"px",zIndex:a.zIndex},t)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":e.modalhead,"aria-hidden":"true"}),void 0===a.drag&&(a.drag=!0),void 0===a.resize&&(a.resize=!0),a.drag)if(v.fn.jqDrag)v(m).css("cursor","move"),v(d).jqDrag(m);else try{v(d).draggable({handle:v("#"+r(m.id))})}catch(e){}if(a.resize)if(v.fn.jqResize)v(u).append("<div class='jqResize ui-resizable-handle ui-resizable-se "+a.resizingRightBottomIcon+"'></div>"),v(s).jqResize(".jqResize",c);else try{v(d).resizable({handles:"se, sw",alsoResize:c})}catch(e){}!0===a.closeOnEscape&&v(d).keydown(function(e){27===e.which&&(e=v(s).data("onClose")||a.onClose,y.hideModal(s,{gb:a.gbox,jqm:a.jqModal,onClose:e,removemodal:a.removemodal||!1,formprop:!a.recreateForm||!1,form:a.form||""}))})},viewModal:function(e,t){if(t=v.extend(!0,{overlay:30,modal:!1,overlayClass:F.call(this,"overlay"),onShow:y.showModal,onHide:y.closeModal,gbox:"",jqm:!0,jqM:!0},y.jqModal||{},t||{}),v.fn.jqm&&!0===t.jqm)(t.jqM?v(e).attr("aria-hidden","false").jqm(t):v(e).attr("aria-hidden","false")).jqmShow();else{""!==t.gbox&&(v(">.jqgrid-overlay",t.gbox).first().show(),v(e).data("gbox",t.gbox)),v(e).show().attr("aria-hidden","false");try{v(":input:visible",e)[0].focus()}catch(e){}}},info_dialog:function(e,t,a,i){var o,l=this,n=l.p,r=v.extend(!0,{width:290,height:"auto",dataheight:"auto",drag:!0,resize:!1,left:250,top:170,zIndex:1e3,jqModal:!0,modal:!1,closeOnEscape:!0,align:"center",buttonalign:"center",buttons:[]},y.jqModal||{},null!=n&&n.jqModal||{},{caption:"<b>"+e+"</b>"},i||{}),d=r.jqModal,s=(v.fn.jqm&&!d&&(d=!1),""),u=F.call(l,"states.hover");if(0<r.buttons.length)for(o=0;o<r.buttons.length;o++)void 0===r.buttons[o].id&&(r.buttons[o].id="info_button_"+o),s+=y.builderFmButon.call(l,r.buttons[o].id,r.buttons[o].text);var n=isNaN(r.dataheight)?r.dataheight:r.dataheight+"px",e="text-align:"+r.align+";",c=v("#info_dialog"),i="<div id='info_id'>";i+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+n+";"+e+"'>"+t+"</div>",!a&&""===s||(i+="<hr class='"+F.call(l,"dialog.hr")+"' style='margin:1px'/><div style='text-align:"+r.buttonalign+";padding:.8em 0 .5em 0;background-image:none;border-width: 1px 0 0 0;'>"+(a?y.builderFmButon.call(l,"closedialog",a):"")+s+"</div>"),i+="</div>";try{"false"===c.attr("aria-hidden")&&y.hideModal("#info_dialog",{jqm:d}),c.remove()}catch(e){}y.createModal.call(l,{themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",resizeAlso:"infocnt"},i,r,"","",!0),c=v("#info_dialog"),s&&v.each(r.buttons,function(){v("#"+y.jqID(this.id),"#info_id").on("click",{click:this.onClick},function(e){return v.jgrid.isFunction(e.data.click)&&e.data.click.call(l,e,c),!1})}),v("#closedialog","#info_id").click(function(){return y.hideModal("#info_dialog",{jqm:d,onClose:c.data("onClose")||r.onClose,gb:c.data("gbox")||r.gbox}),!1}),v(".fm-button","#info_dialog").hover(function(){v(this).addClass(u)},function(){v(this).removeClass(u)}),v.jgrid.isFunction(r.beforeOpen)&&r.beforeOpen(),y.viewModal.call(l,"#info_dialog",{onHide:function(e){e.w.hide().remove(),e.o&&e.o.remove()},modal:r.modal,jqm:d}),v.jgrid.isFunction(r.afterOpen)&&r.afterOpen();try{c.focus()}catch(e){}},bindEv:function(t,a){var i=this.p;v.jgrid.isFunction(a.dataInit)&&a.dataInit.call(this,t,a),a.dataEvents&&v.each(a.dataEvents,function(){var e=void 0===this.data?v.extend({gridId:i.id,gridIdSel:i.idSel},a):"object"==typeof this.data&&null!==this.data?v.extend(!0,{gridId:i.id,gridIdSel:i.idSel},a,this.data):this.data;v(t).on(this.type,e,this.fn)})},createEl:function(e,t,a,i,o){function l(e){return q.call(v(u),e)}var n="",u=this,r=u.p,d=y.info_dialog,s=l("errors.errcap"),c=l("edit"),m=c.msg,f=c.bClose;function h(a,e,t){var i=["dataInit","dataEvents","dataUrl","buildSelect","sopt","searchhidden","defaultValue","attr","custom_element","custom_value","generateValue","postData","selectFilled","rowId","column","mode","cm","iCol"];void 0!==t&&Array.isArray(t)&&v.merge(i,t),v.each(e,function(e,t){-1===v.inArray(e,i)&&v(a).attr(e,t)}),e.hasOwnProperty("id")||v(a).attr("id",y.randId())}if(null==t)return"";switch(e){case"textarea":n=j.createElement("textarea"),i?t.cols||v(n).css({width:"100%","box-sizing":"border-box"}):t.cols||(t.cols=19),t.rows||(t.rows=2),("&nbsp;"===a||"&#160;"===a||1===a.length&&160===a.charCodeAt(0))&&(a=""),n.value=a,h(n,t),v(n).attr({role:"textbox"});break;case"checkbox":(n=j.createElement("input")).type="checkbox",""!==a&&null!=a||(a=t.hasOwnProperty("defaultValue")?v.jgrid.isFunction(t.defaultValue)?t.defaultValue.call(u,{cellValue:a,options:t}):t.defaultValue:"false"),t.value?(a===(p=t.value.split(":"))[0]&&(n.checked=!0,n.defaultChecked=!0),n.value=a,v(n).data("offval",p[1])):((p=String(a).toLowerCase()).search(/(false|f|0|no|n|off|undefined)/i)<0&&""!==p?(n.checked=!0,n.defaultChecked=!0,n.value=a):n.value="on",v(n).data("offval","off")),h(n,t,["value"]),v(n).attr({role:"checkbox","aria-checked":n.checked?"true":"false"});break;case"select":n=j.createElement("select");var g,p=[],F=null;!0===t.multiple||"multiple"===t.multiple?(g=!0,n.multiple="multiple",v(n).attr("aria-multiselectable","true"),p=a.split(","),p=v.map(p,function(e){return v.jgrid.trim(e)})):(g=!1,p[0]=v.jgrid.trim(a)),void 0===t.size&&(t.size=g?3:1);try{F=t.rowId}catch(e){}r&&r.idPrefix&&(F=y.stripPref(r.idPrefix,F)),void 0===t.dataUrl&&t.generateValue&&null!=r.indexByColumnData[t.cm.name]&&(t.value=u.generateValueFromColumnIndex(t.cm.name,t.separator,t.delimiter)),void 0!==t.dataUrl?(x=t.postData||o.postData,p={elem:n,options:t,cm:t.cm,mode:t.mode,rowid:F,iCol:t.iCol,ovm:p},h(n,t,x?["postData"]:void 0),v.ajax(v.extend({url:v.jgrid.isFunction(t.dataUrl)?t.dataUrl.call(u,F,a,String(t.name),p):t.dataUrl,type:"GET",dataType:"html",data:v.jgrid.isFunction(x)?x.call(u,F,a,String(t.name)):x,context:p,success:function(e,t,a){var i=this.ovm,o=this.elem,l=this.cm,n=this.iCol,r=v.extend({},this.options),d=this.rowid,s=this.mode,a=v.jgrid.isFunction(r.buildSelect)?r.buildSelect.call(u,e,a,l,n):e;(a="string"==typeof a?v(v.jgrid.trim(a)).html():a)&&(v(o).append(a),setTimeout(function(){var t;v("option",o).each(function(e){0===e&&o.multiple&&(this.selected=!1),-1<v.inArray(v.jgrid.trim(v(this).val()),i)&&(this.selected=!0,t=!0)}),t||v("option",o).each(function(){-1<v.inArray(v.jgrid.trim(v(this).text()),i)&&(this.selected=!0)}),y.fullBoolFeedback.call(u,r.selectFilled,"jqGridSelectFilled",{elem:o,options:r,cm:l,rowid:d,mode:s,cmName:(null!=l?l:r).name,iCol:n})},0))}},o||{}))):t.value&&(y.fillSelectOptions(n,t.value,void 0===t.separator?":":t.separator,void 0===t.delimiter?";":t.delimiter,g,a),h(n,t,["value"]),y.fullBoolFeedback.call(u,t.selectFilled,"jqGridSelectFilled",{elem:n,options:t,cm:t.cm,rowid:F,mode:t.mode,cmName:(null!=t.cm?t.cm:t).name,iCol:t.iCol}));break;case"text":case"password":case"button":var x="button"===e?"button":"textbox";(n=j.createElement("input")).type=e,h(n,t),n.value=a,"button"!==e&&(i?t.size||v(n).css({width:"100%","box-sizing":"border-box"}):t.size||(t.size=20)),v(n).attr("role",x);break;case"image":case"file":(n=j.createElement("input")).type=e,h(n,t);break;case"custom":n=j.createElement("span");try{if(!v.jgrid.isFunction(t.custom_element))throw"editoptions.custom_element is not a function";var b=t.custom_element.call(u,a,t);if(!(b instanceof jQuery||y.isHTMLElement(b)||"string"==typeof b))throw"editoptions.custom_element returns value of a wrong type";b=v(b).addClass("customelement").attr({id:t.id,name:t.name}),v(n).empty().append(b)}catch(e){"e1"===e&&d.call(u,s,"function 'custom_element' "+m.nodefined,f),"e2"===e?d.call(u,s,"function 'custom_element' "+m.novalue,f):d.call(u,s,"string"==typeof e?e:e.message,f)}}return n},checkDate:function(e,t){var a={},i=-1!==(e=e.toLowerCase()).indexOf("/")?"/":-1!==e.indexOf("-")?"-":-1!==e.indexOf(".")?".":"/";if(e=e.split(i),3!==(t=t.split(i)).length)return!1;for(var o,l=-1,n=-1,r=-1,d=0;d<e.length;d++)o=isNaN(t[d])?0:parseInt(t[d],10),a[e[d]]=o,-1!==(s=e[d]).indexOf("y")&&(l=d),-1!==s.indexOf("m")&&(r=d),-1!==s.indexOf("d")&&(n=d);var s="y"===e[l]||"yyyy"===e[l]?4:"yy"===e[l]?2:-1;return-1!==l&&(i=a[e[l]].toString(),2===s&&1===i.length&&(s=1),i.length===s)&&(0!==a[e[l]]||"00"===t[l])&&-1!==r&&!(a[e[r]].toString().length<1||a[e[r]]<1||12<a[e[r]]||-1===n||a[e[n]].toString().length<1||a[e[n]]<1||31<a[e[n]]||2===a[e[r]]&&a[e[n]]>((i=a[e[l]])%4!=0||i%100==0&&i%400!=0?28:29)||a[e[n]]>[0,31,29,31,30,31,30,31,31,30,31,30,31][a[e[r]]])},isEmpty:function(e){return!(!e.match(/^\s+$/)&&""!==e)},checkTime:function(e){if(!y.isEmpty(e)){if(!(e=e.match(/^(\d{1,2}):(\d{2})([apAP][Mm])?$/)))return!1;if(e[3]){if(e[1]<1||12<e[1])return!1}else if(23<e[1])return!1;if(59<e[2])return!1}return!0},checkValues:function(e,t,a,i,o){function l(e){return e=n[e],v.jgrid.isFunction(e)?e.call(c,o):e}var n,r,d,s,u,c=this,m=c.p,f=m.colModel,h=y.isEmpty,g=q.call(v(c),"edit.msg"),p=q.call(v(c),"formatter.date.masks");if(void 0===a){if(void 0===(t="string"==typeof t?m.iColByName[t]:t)||t<0)return[!0,"",""];s=f[t],n=s.editrules,null!=s.formoptions&&(r=s.formoptions.label)}else n=a,r=void 0===i?"_":i,s=f[t];if(n){if(r=r||(null!=m.colNames?m.colNames[t]:s.label),!0===l("required")&&h(e))return[!1,r+": "+g.required,""];a=!1!==l("required");if(!0===l("number")&&(!1!=a||!h(e))&&isNaN(e))return[!1,r+": "+g.number,""];if(void 0!==n.minValue&&!isNaN(n.minValue)&&parseFloat(e)<parseFloat(n.minValue))return[!1,r+": "+g.minValue+" "+n.minValue,""];if(void 0!==n.maxValue&&!isNaN(n.maxValue)&&parseFloat(e)>parseFloat(n.maxValue))return[!1,r+": "+g.maxValue+" "+n.maxValue,""];if(!0===l("email")&&!(!1==a&&h(e)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(e)))return[!1,r+": "+g.email,""];if(!0===l("integer")&&(!1!=a||!h(e))){if(isNaN(e))return[!1,r+": "+g.integer,""];if(e%1!=0||-1!==e.indexOf("."))return[!1,r+": "+g.integer,""]}if(!0===l("date")&&!(!1==a&&h(e)||(s.formatoptions&&s.formatoptions.newformat?(d=s.formatoptions.newformat,p.hasOwnProperty(d)&&(d=p[d])):d=f[t].datefmt||"Y-m-d",y.checkDate(d,e))))return[!1,r+": "+g.date+" - "+d,""];if(!0===l("time")&&!(!1==a&&h(e)||y.checkTime(e)))return[!1,r+": "+g.date+" - hh:mm (am/pm)",""];if(!0===l("url")&&!(!1==a&&h(e)||/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i.test(e)))return[!1,r+": "+g.url,""];if(!0===n.custom){if(!1!=a||!h(e))return v.jgrid.isFunction(n.custom_func)?(u=n.custom_func.call(c,e,r,t),Array.isArray(u)?u:[!1,g.customarray,""]):[!1,g.customfcheck,""]}else if(v.jgrid.isFunction(n.custom)&&(!1!=a||!h(e)))return u=n.custom.call(c,o),Array.isArray(u)?u:[!1,g.customarray,""]}return[!0,"",""]}})});
//# sourceMappingURL=grid.common.js.map
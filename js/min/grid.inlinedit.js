!function(i){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],i):"object"==typeof module&&module.exports?module.exports=function(e,t){return e=e||window,void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),require("./grid.base"),require("./jquery.fmatter"),require("./grid.common"),i(t),t}:i(jQuery)}(function(k){"use strict";function A(e){return t.getGuiStyles.call(this,"states."+e)}function F(e){var t=k.makeArray(arguments).slice(1);return t.unshift(""),t.unshift("Inline"),t.unshift(e),_.feedback.apply(this,t)}var _=k.jgrid,O=_.fullBoolFeedback,p=_.hasOneFromClasses,t=k.fn.jqGrid;_.inlineEdit=_.inlineEdit||{},_.extend({editRow:function(w,e,t,i,r,a,o,n,d,l){var v={},s=k.makeArray(arguments).slice(1);return"object"===k.type(s[0])?v=s[0]:(void 0!==e&&(v.keys=e),k.jgrid.isFunction(t)&&(v.oneditfunc=t),k.jgrid.isFunction(i)&&(v.successfunc=i),void 0!==r&&(v.url=r),null!=a&&(v.extraparam=a),k.jgrid.isFunction(o)&&(v.aftersavefunc=o),k.jgrid.isFunction(n)&&(v.errorfunc=n),k.jgrid.isFunction(d)&&(v.afterrestorefunc=d),k.jgrid.isFunction(l)&&(v.beforeEditRow=l)),this.each(function(){var o,n,e,t,i,r,s=this,d=k(s),c=s.p,u=0,f=null,m={},p={},a=c.colModel,l=c.prmNames;s.grid&&(o=k.extend(!0,{keys:!1,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeEditRow:null,focusField:!0},_.inlineEdit,c.inlineEditing||{},v),n=d.jqGrid("getInd",w,!0),t="object"==typeof(e=o.focusField)&&null!=e?k(e.target||e).closest("tr.jqgrow>td")[0]:null,!1===n||o.extraparam[l.oper]!==l.addoper&&!F.call(s,o,"beforeEditRow",o,w)||"0"!==(k(n).attr("editable")||"0")||k(n).hasClass("not-editable-row")||(null!=(l=_.detectRowEditing.call(s,w))&&"cellEditing"===l.mode&&(l=l.savedRow,i=s.rows[l.id],r=A.call(s,"select"),d.jqGrid("restoreCell",l.id,l.ic),k(i.cells[l.ic]).removeClass("edit-cell "+r),k(i).addClass(r).attr({"aria-selected":"true",tabindex:"0"})),_.enumEditableCells.call(s,n,k(n).hasClass("jqgrid-new-row")?"add":"edit",function(e){var t,i=e.cm,r=k(e.dataElement),a=e.dataWidth,o=i.name,n=i.edittype,d=e.iCol,l=i.editoptions||{};if(p[o]=e.editable,"hidden"!==e.editable){try{t=k.unformat.call(this,e.td,{rowId:w,colModel:i},d)}catch(e){t="textarea"===n?r.text():r.html()}m[o]=t,r.html(""),o=k.extend({},l,{id:w+"_"+o,name:o,rowId:w,mode:e.mode,cm:i,iCol:d}),("&nbsp;"===t||"&#160;"===t||1===t.length&&160===t.charCodeAt(0))&&(t=""),i=_.createEl.call(s,n,o,t,!0,k.extend({},_.ajaxOptions,c.ajaxSelectOptions||{})),k(i).addClass("editable"),r.append(i),a&&k(i).width(e.dataWidth),_.bindEv.call(s,i,o),"select"===n&&!0===l.multiple&&void 0===l.dataUrl&&_.msie&&k(i).width(k(i).width()),null===f&&(f=d),u++}}),0<u&&(m.id=w,c.savedRow.push(m),c.editingInfo[w]={mode:"inlineEditing",savedRow:m,editable:p},k(n).attr("editable","1"),e&&("number"==typeof e&&parseInt(e,10)<=a.length?f=e:"string"==typeof e?f=c.iColByName[e]:null!=t&&(f=t.cellIndex),setTimeout(function(){function e(e){return(c.frozenColumns&&0<r&&f<r?s.grid.fbRows[n.rowIndex]:n).cells[e]}function t(e){return k(e).find("input,textarea,select,button,object,*[tabindex]").filter(":input:visible:not(:disabled)")}function i(){return t(c.frozenColumns&&0<r?s.grid.fbRows[n.rowIndex]:n).first()}var r=d.jqGrid("getNumberOfFrozenColumns"),a=t(e(f));(0<a.length?a.first():"number"==typeof o.defaultFocusField||"string"==typeof o.defaultFocusField?(a=0===(a=t(e("number"==typeof o.defaultFocusField?o.defaultFocusField:c.iColByName[o.defaultFocusField]))).length?i():a).first():i()).focus()},0)),!0===o.keys&&(l=k(n),(l=c.frozenColumns?l.add(s.grid.fbRows[n.rowIndex]):l).on("keydown",function(e){return 27===e.keyCode?(d.jqGrid("restoreRow",w,o.afterrestorefunc),!1):13===e.keyCode?"TEXTAREA"===e.target.tagName||(d.jqGrid("saveRow",w,o),!1):void 0})),O.call(s,o.oneditfunc,"jqGridInlineEditRow",w,o))))})},saveRow:function(o,e,t,i,r,a,n,d){var l,s=k.makeArray(arguments).slice(1),c={},u=this[0],f=k(u),m=null!=u?u.p:null,p=_.info_dialog,w=k.jgrid.isFunction,v=null!=_.defaults&&w(_.defaults.fatalError)?_.defaults.fatalError:alert;if(u.grid&&null!=m){"object"===k.type(s[0])?c=s[0]:(w(e)&&(c.successfunc=e),void 0!==t&&(c.url=t),void 0!==i&&(c.extraparam=i),w(r)&&(c.aftersavefunc=r),w(a)&&(c.errorfunc=a),w(n)&&(c.afterrestorefunc=n),w(d)&&(c.beforeSaveRow=d));var g,j,h,R,x,q,s=function(e){return f.jqGrid("getGridRes",e)},c=k.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeSaveRow:null,ajaxSaveOptions:{},serializeSaveData:null,mtype:"POST",saveui:"enable",savetext:s("defaults.savetext")||"Saving..."},_.inlineEdit,m.inlineEditing||{},c),b={},y={},I={},G=f.jqGrid("getInd",o,!0),E=k(G),e=m.prmNames,C=s("errors.errcap"),P=s("edit.bClose"),S=function(t,e){try{var i=_.getRelativeRect.call(u,e);p.call(u,C,t,P,{top:i.top,left:i.left+k(u).closest(".ui-jqgrid").offset().left})}catch(e){v(t)}};if(!1!==G&&(l=c.extraparam[e.oper]===e.addoper?"add":"edit",F.call(u,c,"beforeSaveRow",c,o,l))&&(t=E.attr("editable"),c.url=c.url||m.editurl,x="clientArray"!==c.url,"1"===t)){if(R=k.jgrid.detectRowEditing.call(u,o),_.enumEditableCells.call(u,G,E.hasClass("jqgrid-new-row")?"add":"edit",function(e){var t=e.cm,i=t.formatter,r=t.editoptions||{},a=t.formatoptions||{},o={},n=_.getEditedValue.call(u,k(e.dataElement),t,o,e.editable);if("select"===t.edittype&&"select"!==t.formatter&&(y[t.name]=o.text),null!=(h=_.checkValues.call(u,n,e.iCol,void 0,void 0,k.extend(e,{oldValue:null!=R?R.savedRow[t.name]:null,newValue:n,oldRowData:null!=R?R.savedRow:null})))&&!1===h[0])return q=!0,S(h[1],e.td),!1;"date"===i&&!0!==a.sendFormatted&&(n=k.unformat.date.call(u,n,t)),x&&!0===r.NullIfEmpty&&""===n&&(n="null"),b[t.name]=n}),q)return;var e=m.prmNames,D=!1===m.keyName?e.id:m.keyName,i=(b&&(b[e.oper]=e.editoper,void 0!==b[D]&&""!==b[D]||(b[D]=_.stripPref(m.idPrefix,o)),b=k.extend({},b,m.inlineData||{},c.extraparam)),{options:c,rowid:o,tr:G,iRow:G.rowIndex,savedRow:R.savedRow,newData:b,mode:l});if(!F.call(u,c,"saveRowValidation",i))return void(i.errorText&&S(i.errorText,G));if(x)f.jqGrid("progressBar",{method:"show",loadtype:c.saveui,htmlcontent:c.savetext}),(I=k.extend({},b,I))[D]=_.stripPref(m.idPrefix,I[D]),m.autoEncodeOnEdit&&k.each(I,function(e,t){w(t)||(I[e]=_.oldEncodePostedData(t))}),G.id===m.idPrefix+I[D]||null==e.idold||I.hasOwnProperty(e.idold)||(I[e.idold]=_.stripPref(m.idPrefix,G.id)),k.ajax(k.extend({url:w(c.url)?c.url.call(u,I[D],l,I,c):c.url,data:_.serializeFeedback.call(u,w(c.serializeSaveData)?c.serializeSaveData:m.serializeRowData,"jqGridInlineSerializeSaveData",I),type:w(c.mtype)?c.mtype.call(u,l,c,I[D],I):c.mtype,complete:function(e,t){if(f.jqGrid("progressBar",{method:"hide",loadtype:c.saveui}),(e.status<300||304===e.status)&&(0!==e.status||4!==e.readyState)){var i,r,a=f.triggerHandler("jqGridInlineSuccessSaveRow",[e,o,c,l,I]);if((a=null!=a&&!0!==a?a:[!0,b])[0]&&w(c.successfunc)&&(a=c.successfunc.call(u,e,o,c,l,I)),Array.isArray(a)?(i=a[0],b=a[1]||b):i=a,!0===i){for(m.autoEncodeOnEdit&&k.each(b,function(e,t){b[e]=_.oldDecodePostedData(t)}),b=k.extend({},b,y),f.jqGrid("setRowData",o,b),E.attr("editable","0"),r=0;r<m.savedRow.length;r++)if(String(m.savedRow[r].id)===String(o)){j=r;break}0<=j&&(m.savedRow.splice(j,1),delete m.editingInfo[o]),O.call(u,c.aftersavefunc,"jqGridInlineAfterSaveRow",o,e,b,c),null!=a[2]?f.jqGrid("changeRowid",o,m.idPrefix+a[2]):G.id!==m.idPrefix+b[D]&&f.jqGrid("changeRowid",G.id,m.idPrefix+b[D]),E.removeClass("jqgrid-new-row").off("keydown")}else O.call(u,c.errorfunc,"jqGridInlineErrorSaveRow",o,e,t,null,c),!0===c.restoreAfterError&&f.jqGrid("restoreRow",o,c.afterrestorefunc)}},error:function(e,t,i){if(f.triggerHandler("jqGridInlineErrorSaveRow",[o,e,t,i,c]),w(c.errorfunc))c.errorfunc.call(u,o,e,t,i);else{t=e.responseText||e.statusText;try{p.call(u,C,'<div class="'+A.call(u,"error")+'">'+t+"</div>",P,{buttonalign:"right"})}catch(e){v(t)}}!0===c.restoreAfterError&&f.jqGrid("restoreRow",o,c.afterrestorefunc)}},_.ajaxOptions,m.ajaxRowOptions,c.ajaxSaveOptions||{}));else{for(b=k.extend({},b,y),r=f.jqGrid("setRowData",o,b),E.attr("editable","0"),g=0;g<m.savedRow.length;g++)if(String(m.savedRow[g].id)===String(o)){j=g;break}0<=j&&(m.savedRow.splice(j,1),delete m.editingInfo[o]),O.call(u,c.aftersavefunc,"jqGridInlineAfterSaveRow",o,r,b,c),E.removeClass("jqgrid-new-row").off("keydown"),G.id!==m.idPrefix+b[D]&&f.jqGrid("changeRowid",G.id,m.idPrefix+b[D])}}}},restoreRow:function(l,e){var t=k.makeArray(arguments).slice(1),s={};return"object"===k.type(t[0])?s=t[0]:k.jgrid.isFunction(e)&&(s.afterrestorefunc=e),this.each(function(){var e,t=this,i=k(t),r=t.p,a=-1,o={};if(t.grid){var n=k.extend(!0,{},_.inlineEdit,r.inlineEditing||{},s),d=i.jqGrid("getInd",l,!0);if(!1!==d&&F.call(t,n,"beforeCancelRow",n,l)){for(e=0;e<r.savedRow.length;e++)if(String(r.savedRow[e].id)===String(l)){a=e;break}if(0<=a){if(k.jgrid.isFunction(k.fn.datepicker))try{k("input.hasDatepicker","#"+_.jqID(d.id)).datepicker("hide")}catch(e){}k.each(r.colModel,function(){var e=this.name;r.savedRow[a].hasOwnProperty(e)&&(o[e]=r.savedRow[a][e],!this.formatter||"date"!==this.formatter||null!=this.formatoptions&&!0===this.formatoptions.sendFormatted||(o[e]=k.unformat.date.call(t,o[e],this)))}),i.jqGrid("setRowData",l,o),k(d).attr("editable","0").off("keydown"),r.savedRow.splice(a,1),delete r.editingInfo[l],k("#"+_.jqID(l),t).hasClass("jqgrid-new-row")&&setTimeout(function(){i.jqGrid("delRowData",l),i.jqGrid("showAddEditButtons",!1)},0)}O.call(t,n.afterrestorefunc,"jqGridInlineAfterRestoreRow",l)}}})},addRow:function(o){return this.each(function(){var t,e,i,r,a;this.grid&&(e=k(t=this),r=t.p,i=k.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,beforeAddRow:null,addRowParams:{extraparam:{}}},_.inlineEdit,r.inlineEditing||{},o||{}),F.call(t,i,"beforeAddRow",i.addRowParams))&&(i.rowID=k.jgrid.isFunction(i.rowID)?i.rowID.call(t,i):null!=i.rowID?i.rowID:_.randId(),!0===i.useDefValues&&k(r.colModel).each(function(){var e;this.editoptions&&this.editoptions.defaultValue&&(e=this.editoptions.defaultValue,i.initdata[this.name]=k.jgrid.isFunction(e)?e.call(t,i):e)}),i.rowID=r.idPrefix+i.rowID,e.jqGrid("addRowData",i.rowID,i.initdata,i.position,i.srcRowid),k("#"+_.jqID(i.rowID),t).addClass("jqgrid-new-row"),i.useFormatter?k("#"+_.jqID(i.rowID)+" .ui-inline-edit",t).click():(a=(r=r.prmNames).oper,i.addRowParams.extraparam[a]=r.addoper,e.jqGrid("editRow",i.rowID,i.addRowParams),e.jqGrid("setSelection",i.rowID)))})},inlineNav:function(f,m){return"object"==typeof f&&(m=f,f=void 0),this.each(function(){var a=this,o=k(a),n=a.p;if(this.grid&&null!=n){var e,t=f===n.toppager?n.idSel+"_top":n.idSel,i=f===n.toppager?n.id+"_top":n.id,d=A.call(a,"disabled"),l=k.extend(!0,{edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",commonIconClass:"ui-icon",iconsOverText:!1,addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0},o.jqGrid("getGridRes","nav"),_.nav||{},n.navOptions||{},_.inlineNav||{},n.inlineNavOptions||{},m||{}),s=function(){a.modalAlert()};if(void 0===f)if(n.pager){if(o.jqGrid("inlineNav",n.pager,l),!n.toppager)return;f=n.toppager,t=n.idSel+"_top",i=n.id+"_top"}else n.toppager&&(f=n.toppager,t=n.idSel+"_top",i=n.id+"_top");if(void 0!==f&&!((e=k(f)).length<=0)){if(e.find(".navtable").length<=0&&o.jqGrid("navGrid",f,{add:!1,edit:!1,del:!1,search:!1,refresh:!1,view:!1}),(n._inlinenav=!0)===l.addParams.useFormatter)for(var r,c=n.colModel,u=0;u<c.length;u++)if(c[u].formatter&&"actions"===c[u].formatter){c[u].formatoptions&&(r=k.extend({keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},c[u].formatoptions),l.addParams.addRowParams={keys:r.keys,oneditfunc:r.onEdit,successfunc:r.onSuccess,url:r.url,extraparam:r.extraparam,aftersavefunc:r.afterSave,errorfunc:r.onError,afterrestorefunc:r.afterRestore});break}l.add&&o.jqGrid("navButtonAdd",f,{caption:l.addtext,title:l.addtitle,commonIconClass:l.commonIconClass,buttonicon:l.addicon,iconsOverText:l.iconsOverText,id:i+"_iladd",onClickButton:function(){p(this,d)||o.jqGrid("addRow",l.addParams)}}),l.edit&&o.jqGrid("navButtonAdd",f,{caption:l.edittext,title:l.edittitle,commonIconClass:l.commonIconClass,buttonicon:l.editicon,iconsOverText:l.iconsOverText,id:i+"_iledit",onClickButton:function(){var e;p(this,d)||((e=n.selrow)?o.jqGrid("editRow",e,l.editParams):s())}}),l.save&&(o.jqGrid("navButtonAdd",f,{caption:l.savetext,title:l.savetitle,commonIconClass:l.commonIconClass,buttonicon:l.saveicon,iconsOverText:l.iconsOverText,id:i+"_ilsave",onClickButton:function(){var e,t,i,r;!p(this,d)&&0<n.savedRow.length&&((e=n.savedRow[0].id)?(i=(t=n.prmNames).oper,r=l.editParams,k("#"+_.jqID(e),a).hasClass("jqgrid-new-row")?(l.addParams.addRowParams.extraparam[i]=t.addoper,r=l.addParams.addRowParams):(l.editParams.extraparam||(l.editParams.extraparam={}),l.editParams.extraparam[i]=t.editoper),o.jqGrid("saveRow",e,r)):s())}}),k(t+"_ilsave").addClass(d)),l.cancel&&(o.jqGrid("navButtonAdd",f,{caption:l.canceltext,title:l.canceltitle,commonIconClass:l.commonIconClass,buttonicon:l.cancelicon,iconsOverText:l.iconsOverText,id:i+"_ilcancel",onClickButton:function(){var e,t;!p(this,d)&&0<n.savedRow.length&&(e=n.savedRow[0].id,t=l.editParams,e?(k("#"+_.jqID(e),a).hasClass("jqgrid-new-row")&&(t=l.addParams.addRowParams),o.jqGrid("restoreRow",e,t)):s())}}),k(t+"_ilcancel").addClass(d)),!0===l.restoreAfterSelect&&o.on("jqGridSelectRow",function(e,t){0<n.savedRow.length&&!0===n._inlinenav&&t!==(t=n.savedRow[0].id)&&"number"!=typeof t&&o.jqGrid("restoreRow",t,l.editParams)}),o.on("jqGridInlineAfterRestoreRow jqGridInlineAfterSaveRow",function(){o.jqGrid("showAddEditButtons",!1)}),o.on("jqGridInlineEditRow",function(e,t){o.jqGrid("showAddEditButtons",!0,t)})}}})},showAddEditButtons:function(a){return this.each(function(){var e,t,i,r;this.grid&&(e=(r=this.p).idSel,t=A.call(this,"disabled"),i=e+"_ilsave,"+e+"_ilcancel"+(r.toppager?","+e+"_top_ilsave,"+e+"_top_ilcancel":""),r=e+"_iladd,"+e+"_iledit"+(r.toppager?","+e+"_top_iladd,"+e+"_top_iledit":""),k(a?r:i).addClass(t),k(a?i:r).removeClass(t))})}})});
//# sourceMappingURL=grid.inlinedit.js.map
!function(t,i){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","free-jqgrid-plugins/ui.multiselect","jquery-ui/dialog","jquery-ui/draggable","jquery-ui/droppable","jquery-ui/resizable","jquery-ui/sortable"],function(e){return i(e,t,t.document)}):"object"==typeof module&&module.exports?module.exports=function(e,t){return e=e||window,void 0===t&&(t="undefined"!=typeof window?require("jquery"):require("jquery")(e)),require("./grid.base"),require("free-jqgrid-plugins/ui.multiselect"),require("jquery-ui/dialog"),require("jquery-ui/draggable"),require("jquery-ui/droppable"),require("jquery-ui/resizable"),require("jquery-ui/sortable"),i(t,e,e.document),t}:i(jQuery,t,t.document)}("undefined"!=typeof window?window:this,function(w,_,d){"use strict";function q(i){if(null!=this.grid&&null!=this.grid.p){var o,e,t,r,n,d=this,a=this.grid.p,l=this.gh,s=this.selectedList,u=this.inGroup,c=s.find("li"),p=c.length-1,h=function(e,t,i){for(var o,r=s.find("li"),n=t=void 0===t?i?r.length-1:0:t;i?0<=n:n<r.length;i?n--:n++)if((o=w(r[n]).data("optionLink"))&&e.call(r[n],parseInt(o.val(),10),n))return n},g=function(){0<=(n=w.inArray(a.colModel[i].name,d.newColOrder))&&d.newColOrder.splice(n,1),c=s.find("li"),o=0,h(function(e,t){if(e===i){for(p=t;0<=o&&o<a.colModel.length&&o!==i&&(a.colModel[o].hidden||a.colModel[o].hidedlg)&&(null==u||u[o]===u[i]);)o++;return d.newColOrder.splice(o,0,a.colModel[i].name),!0}(o=w.inArray(a.colModel[e].name,d.newColOrder,o))<0&&(o=w.inArray(a.colModel[e].name,d.newColOrder)),o++})},f=function(e){if(u[e]===u[i])return w(this).after(c[p]),g(),!0},m=function(e){if(u[e]===u[i])return w(this).before(c[p]),g(),!0},b=function(e){if(u[e]===u[i]&&void 0!==u[e])return l[u[e]].startColumnName=a.colModel[e].name,!0};if(g(),l&&void 0!==l[u[i]]){for(e=l[u[i]],n=0;n<e.numberOfColumns;n++)if(o=a.iColByName[e.startColumnName]+n,!a.colModel[o].hidden&&!a.colModel[o].hidedlg){h(f,p-1,!0),h(m,p+1),h(b);break}}else l&&(c=s.find("li"),(n=h(function(e){if(e===i)return!0}))+1>=c.length||n<0||(t=w(c[n+1]).data("optionLink"))&&void 0!==(r=u[parseInt(t.val(),10)])&&(t=w(c[n-1]).data("optionLink"))&&u[parseInt(t.val(),10)]===r&&(t=h(function(e){if(u[e]!==r)return!0},n+1),w(c[void 0===t||t>=c.length?c.length-1:t-1]).after(c[p]),g()))}}var r,G=w.jgrid,x=G.jqID,C=null!=w.ui?w.ui.multiselect:null;G.msie&&8===G.msiever()&&(w.expr[":"].hidden=function(e){return 0===e.offsetWidth||0===e.offsetHeight||"none"===e.style.display}),G._multiselect=!1,C&&(C.prototype._setSelected&&(r=C.prototype._setSelected,C.prototype._setSelected=function(e,t){var i=r.call(this,e,t),o=this.element,e=parseInt(e.data("optionLink").val(),10);return t&&this.selectedList&&(q.call(this,e),this.selectedList.find("li").each(function(){w(this).data("optionLink")&&w(this).data("optionLink").remove().appendTo(o)})),i}),C.prototype.destroy&&(C.prototype.destroy=function(){var e=this;e.element.show(),e.container.remove(),(void 0===w.Widget?w.widget:w.Widget).prototype.destroy.apply(e,arguments)}),G._multiselect=!0),G.extend({sortableColumns:function(t){return this.each(function(){var i,r=this,n=r.p,e=x(n.id);function o(){n.disableClick=!0}n&&n.sortable&&w.jgrid.isFunction(w.fn.sortable)&&(e={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+e+"_cb,#jqgh_"+e+"_rn,#jqgh_"+e+"_subgrid),:hidden)",placeholder:{element:function(e){return w(d.createElement(e[0].nodeName)).addClass(e[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(e,t){t.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),t.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10))}},start:function(){r.grid.hDiv.scrollLeft=r.grid.bDiv.scrollLeft},update:function(e,t){var t=w(">th",w(t.item).parent()),i=n.id+"_",o=[];t.each(function(){var e=w(">div",this).get(0).id.replace(/^jqgh_/,"").replace(i,""),e=n.iColByName[e];void 0!==e&&o.push(e)}),w(r).jqGrid("remapColumns",o,!0,!0),w.jgrid.isFunction(n.sortable.update)&&n.sortable.update(o),setTimeout(function(){n.disableClick=!1},50)}},n.sortable.options?w.extend(e,n.sortable.options):w.jgrid.isFunction(n.sortable)&&(n.sortable={update:n.sortable}),e.start?(i=e.start,e.start=function(e,t){o(),i.call(this,e,t)}):e.start=o,n.sortable.exclude&&(e.items+=":not("+n.sortable.exclude+")"),null!=(e=(e=t.sortable(e)).data("sortable")||e.data("uiSortable")||e.data("ui-sortable")))&&(e.floating=!0)})},columnChooser:function(n){function i(e){return C&&C.prototype&&e.data(C.prototype.widgetFullName||C.prototype.widgetName)||e.data("ui-multiselect")||e.data("multiselect")}var t,d,a,e,l=this,o=l[0],s=o.p,u=s.colModel,r=u.length,c=s.colNames;if(!w("#colchooser_"+x(s.id)).length){if(t=w('<div id="colchooser_'+s.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),d=w("select",t),n=w.extend({width:400,height:240,classname:null,done:function(e){e&&l.jqGrid("remapColumns",e,!0)},msel:"multiselect",dlog:"dialog",dialog_opts:{minWidth:470,dialogClass:"ui-jqdialog"},dlog_opts:function(e){var t={};return t[e.bSubmit]=function(){e.apply_perm(),e.cleanup(!1)},t[e.bCancel]=function(){e.cleanup(!0)},w.extend(!0,{buttons:t,close:function(){e.cleanup(!0)},modal:e.modal||!1,resizable:e.resizable||!0,width:e.width+70,resize:function(){var e=i(d),t=e.container.closest(".ui-dialog-content");0<t.length&&"object"==typeof t[0].style?t[0].style.width="":t.css("width",""),e.selectedList.height(Math.max(e.selectedContainer.height()-e.selectedActions.outerHeight()-1,1)),e.availableList.height(Math.max(e.availableContainer.height()-e.availableActions.outerHeight()-1,1))}},e.dialog_opts||{})},apply_perm:function(){for(var e,t=new Array(s.colModel.length),i={notSkipFrozen:void 0!==n.notSkipFrozen&&n.notSkipFrozen,skipSetGridWidth:!0,skipSetGroupHeaders:!0},o=0;o<s.colModel.length;o++)t[o]=s.iColByName[a.newColOrder[o]];if(w("option",d).each(function(){w(this).is(":selected")?l.jqGrid("showCol",u[this.value].name,i):l.jqGrid("hideCol",u[this.value].name,i)}),n.done&&n.done.call(l,t),s.groupHeader&&("object"==typeof s.groupHeader||w.jgrid.isFunction(s.groupHeader)))if(l.jqGrid("destroyGroupHeader",!1),s.groupHeader.groupHeaders=a.gh,null!=s.pivotOptions&&null!=s.pivotOptions.colHeaders&&1<s.pivotOptions.colHeaders.length)for(e=s.pivotOptions.colHeaders,o=0;o<e.length;o++)e[o]&&e[o].groupHeaders.length&&l.jqGrid("setGroupHeaders",e[o]);else l.jqGrid("setGroupHeaders",s.groupHeader);var r=s.autowidth||void 0!==s.widthOrg&&"auto"!==s.widthOrg&&"100%"!==s.widthOrg?s.width:s.tblwidth;r!==s.width&&l.jqGrid("setGridWidth",r,s.shrinkToFit)},cleanup:function(e){y(n.dlog,t,"destroy"),y(n.msel,d,"destroy"),t.remove(),e&&n.done&&n.done.call(l)},msel_opts:{}},l.jqGrid("getGridRes","col"),G.col,n||{}),w.ui&&C&&C.defaults){if(!G._multiselect)return void(null!=G.defaults&&w.jgrid.isFunction(G.defaults.fatalError)?G.defaults.fatalError:alert)("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");n.msel_opts=w.extend(C.defaults,n.msel_opts)}n.caption&&t.attr("title",n.caption),n.classname&&(t.addClass(n.classname),d.addClass(n.classname)),n.width&&(w(">div",t).css({width:n.width,margin:"0 auto"}),d.css("width",n.width)),n.height&&(w(">div",t).css("height",n.height),d.css("height",n.height-10)),d.empty();var p,h,g,f,m,b,j=null!=s.groupHeader?s.groupHeader.groupHeaders:0,v={};if(j)for(p=0;p<j.length;p++)for(f=j[p],h=0;h<f.numberOfColumns;h++)g=s.iColByName[f.startColumnName]+h,v[g]=w.jgrid.isFunction(n.buildItemText)?n.buildItemText.call(l[0],{iCol:g,cm:u[g],cmName:u[g].name,colName:c[g],groupTitleText:f.titleText}):w.jgrid.stripHtml(f.titleText)+": "+w.jgrid.stripHtml(""===c[g]?u[g].name:c[g]);for(g=0;g<r;g++)void 0===v[g]&&(v[g]=w.jgrid.isFunction(n.buildItemText)?n.buildItemText.call(l[0],{iCol:g,cm:u[g],cmName:u[g].name,colName:c[g],groupTitleText:null}):w.jgrid.stripHtml(c[g]));if(w.each(u,function(e){this.hidedlg||d.append("<option value='"+e+"'"+(s.headertitles||this.headerTitle?" title='"+G.stripHtml("string"==typeof this.headerTitle?this.headerTitle:v[e])+"'":"")+(this.hidden?"":" selected='selected'")+">"+v[e]+"</option>")}),e=w.jgrid.isFunction(n.dlog_opts)?n.dlog_opts.call(l,n):n.dlog_opts,y(n.dlog,t,e),e=w.jgrid.isFunction(n.msel_opts)?n.msel_opts.call(l,n):n.msel_opts,y(n.msel,d,e),(e=w("#colchooser_"+x(s.id))).css({margin:"auto"}),e.find(">div").css({width:"100%",height:"100%",margin:"auto"}),a=i(d)){if(a.grid=o,j)for(a.gh=w.extend(!0,[],j),a.inGroup=new Array(s.colModel.length),m=0;m<j.length;m++)for(b=j[m],g=0;g<b.numberOfColumns;g++)a.inGroup[s.iColByName[b.startColumnName]+g]=m;a.newColOrder=w.map(u,function(e){return e.name}),a.container.css({width:"100%",height:"100%",margin:"auto"}),a.selectedContainer.css({width:100*a.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),a.availableContainer.css({width:100-100*a.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),a.selectedList.css("height","auto"),a.availableList.css("height","auto"),e=Math.max(a.selectedList.height(),a.availableList.height()),e=Math.min(e,w(_).height()),a.selectedList.css("height",e),a.availableList.css("height",e),null!=a.options&&a.options.sortable&&a.selectedList.on("sortupdate",function(e,t){q.call(a,parseInt(t.item.data("optionLink").val(),10)),t.item.css({width:"",height:""}),w.jgrid.isFunction(n.sortUpdate)&&n.sortUpdate.call(o,e,t)}),w.jgrid.isFunction(n.init)&&n.init.call(o,a)}}function y(e,t){e&&("string"==typeof e?w.fn[e]&&w.fn[e].apply(t,w.makeArray(arguments).slice(2)):w.jgrid.isFunction(e)&&e.apply(t,w.makeArray(arguments).slice(2)))}},sortableRows:function(d){return this.each(function(){var o=this,r=o.grid,n=o.p;r&&!n.treeGrid&&w.fn.sortable&&((d=w.extend({cursor:"move",axis:"y",items:">tbody>.jqgrow"},d||{})).start&&w.jgrid.isFunction(d.start)?(d._start_=d.start,delete d.start):d._start_=!1,d.update&&w.jgrid.isFunction(d.update)?(d._update_=d.update,delete d.update):d._update_=!1,d.start=function(e,t){if(w(t.item).css("border-width","0"),w("td",t.item).each(function(e){this.style.width=r.cols[e].style.width}),n.subGrid){var i=w(t.item).attr("id");try{w(o).jqGrid("collapseSubGridRow",i)}catch(e){}}d._start_&&d._start_.apply(this,[e,t])},d.update=function(e,t){w(t.item).css("border-width",""),!0===n.rownumbers&&w("td.jqgrid-rownum",o.rows).each(function(e){w(this).html(e+1+(parseInt(n.page,10)-1)*parseInt(n.rowNum,10))}),d._update_&&d._update_.apply(this,[e,t])},w(o).sortable(d))})},gridDnD:function(o){return this.each(function(){var e,t,g=this;if(g.grid&&!g.p.treeGrid&&w.fn.draggable&&w.fn.droppable)if(void 0===w("#jqgrid_dnd")[0]&&w("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>"),"string"==typeof o&&"updateDnD"===o&&!0===g.p.jqgdnd)i();else if((o=w.extend({drag:function(r){return w.extend({start:function(e,t){var i,o;if(g.p.subGrid){o=w(t.helper).attr("id");try{w(g).jqGrid("collapseSubGridRow",o)}catch(e){}}for(i=0;i<w.data(g,"dnd").connectWith.length;i++)0===w(w.data(g,"dnd").connectWith[i]).jqGrid("getGridParam","reccount")&&w(w.data(g,"dnd").connectWith[i]).jqGrid("addRowData","jqg_empty_row",{});t.helper.addClass("ui-state-highlight"),w("td",t.helper).each(function(e){this.style.width=g.grid.headers[e].width+"px"}),r.onstart&&w.jgrid.isFunction(r.onstart)&&r.onstart.call(w(g),e,t)},stop:function(e,t){var i,o;for(t.helper.dropped&&!r.dragcopy&&(void 0===(o=w(t.helper).attr("id"))&&(o=w(this).attr("id")),w(g).jqGrid("delRowData",o)),i=0;i<w.data(g,"dnd").connectWith.length;i++)w(w.data(g,"dnd").connectWith[i]).jqGrid("delRowData","jqg_empty_row");r.onstop&&w.jgrid.isFunction(r.onstop)&&r.onstop.call(w(g),e,t)}},r.drag_opts||{})},drop:function(h){return w.extend({accept:function(e){var t;return w(e).hasClass("jqgrow")?0<(t=w(e).closest("table.ui-jqgrid-btable")).length&&void 0!==w.data(t[0],"dnd")&&(t=w.data(t[0],"dnd").connectWith,-1!==w.inArray("#"+x(this.id),t)):e},drop:function(e,t){if(w(t.draggable).hasClass("jqgrow")){var i,o=w(t.draggable).attr("id"),r=t.draggable.parent().parent(),n=r.jqGrid("getRowData",o);if(!h.dropbyname){var d,a,l,s,u={},c=r.jqGrid("getGridParam","colModel"),p=w("#"+x(this.id)).jqGrid("getGridParam","colModel");try{for(a=d=0;d<c.length&&a<p.length;d++)if("cb"!==(l=c[d].name)&&"rn"!==l&&"subgrid"!==l){for(;a<p.length;a++)if("cb"!==(s=p[a].name)&&"rn"!==s&&"subgrid"!==s){u[s]=n[l];break}a++}n=u}catch(e){}}t.helper.dropped=!0,h.beforedrop&&w.jgrid.isFunction(h.beforedrop)&&null!=(r=h.beforedrop.call(this,e,t,n,w("#"+x(g.p.id)),w(this)))&&"object"==typeof r&&(n=r),t.helper.dropped&&(h.autoid&&(i=w.jgrid.isFunction(h.autoid)?h.autoid.call(this,n,{rowid:o,ev:e,ui:t}):(i=Math.ceil(1e3*Math.random()),h.autoidprefix+i)),w("#"+x(this.id)).jqGrid("addRowData",i,n,h.droppos),n[g.p.localReader.id]=i),h.ondrop&&w.jgrid.isFunction(h.ondrop)&&h.ondrop.call(this,e,t,n)}}},h.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},o||{})).connectWith)for(o.connectWith=o.connectWith.split(","),o.connectWith=w.map(o.connectWith,function(e){return w.jgrid.trim(e)}),w.data(g,"dnd",o),0===g.p.reccount||g.p.jqgdnd||i(),g.p.jqgdnd=!0,e=0;e<o.connectWith.length;e++)t=o.connectWith[e],w(t).droppable(w.jgrid.isFunction(o.drop)?o.drop.call(w(g),o):o.drop);function i(){var e=w.data(g,"dnd");w("tr.jqgrow:not(.ui-draggable)",g).draggable(w.jgrid.isFunction(e.drag)?e.drag.call(w(g),e):e.drag)}})},gridResize:function(s){return this.each(function(){var i,e,o=this,r=o.grid,n=o.p,d=n.gView+">.ui-jqgrid-bdiv",a=!1,l=n.height;r&&w.fn.resizable&&((s=w.extend({},s||{})).alsoResize?(s._alsoResize_=s.alsoResize,delete s.alsoResize):s._alsoResize_=!1,s.stop&&w.jgrid.isFunction(s.stop)?(s._stop_=s.stop,delete s.stop):s._stop_=!1,s.stop=function(e,t){w(o).jqGrid("setGridWidth",t.size.width,s.shrinkToFit),w(n.gView+">.ui-jqgrid-titlebar").css("width",""),a?(w(i).each(function(){w(this).css("height","")}),"auto"!==l&&"100%"!==l||w(r.bDiv).css("height",l)):w(o).jqGrid("setGridParam",{height:w(d).height()}),o.fixScrollOffsetAndhBoxPadding&&o.fixScrollOffsetAndhBoxPadding(),s._stop_&&s._stop_.call(o,e,t)},i=d,"auto"!==l&&"100%"!==l||void 0!==s.handles||(s.handles="e,w"),s.handles&&2===(e=w.map(String(s.handles).split(","),function(e){return w.jgrid.trim(e)})).length&&("e"===e[0]&&"w"===e[1]||"e"===e[1]&&"w"===e[1])&&(i=n.gView+">div:not(.frozen-div)",a=!0,n.pager)&&(i+=","+n.pager),s._alsoResize_?s.alsoResize=i+","+s._alsoResize_:s.alsoResize=i,delete s._alsoResize_,w(n.gBox).resizable(s))})}})});
//# sourceMappingURL=grid.jqueryui.js.map